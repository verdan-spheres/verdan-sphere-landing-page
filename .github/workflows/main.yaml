name: CI workflow for next

#trigger
on:
  push:
  pull_request:
    types: [opened, synchronize, reopened]
    branches:
      - main
      - dev

jobs:
  build:
    name: "Build the Next.js static Application"
    uses: ./.github/workflows/build.yaml

  test:
    needs: [build]
    name: test the application
    uses: ./.github/workflows/test.yaml

  code_scanning:
    name: "reusable for the code scanning"
    uses: ./.github/workflows/CodeScan.yaml
    secrets:
      SONAR_TOKEN: ${{secrets.SONAR_TOKEN}}
      SONAR_HOST_URL: ${{secrets.SONAR_HOST_URL}}

  artifact_upload:
    name: "reusable workflow for the release"
    uses: ./.github/workflows/release.yaml
    secrets:
      AWS_ACCESS_KEY_ID: ${{secrets.AWS_ACCESS_KEY_ID}}
      AWS_SECRECT_KEY: ${{secrets.AWS_SECRECT_KEY}}
      S3_BUCKET_NAME: ${{secrets.S3_BUCKET_NAME}}
